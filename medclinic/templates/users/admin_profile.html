{% extends 'base.html' %}
{% load static %}

{% block content %}
    <h1>Админка</h1>
<table border="1">
    <tr>
        <th>Номер заказа</th>
        <th>Статус</th>
        <th>Имя</th>
        <th>Телефон</th>
        <th>Email</th>
        <th>Сумма</th>
        <th>Дата/Время</th>
    </tr>
    {% for order in orders_all %}
    <tr>
        <td>{{ order.id }}</td>
        <td>
            {% if order.user %}
                Пользователь
            {% else %}
                Гость
            {% endif %}
        </td>
        <td>
            {% if order.user %}
                {{ order.user.get_full_name }}
            {% else %}
                {{ order.guest_name|default:"—" }}
            {% endif %}
        </td>
        <td>
            {% if order.user %}
                {{ order.user.phone_number|default:"—" }}
            {% else %}
                {{ order.guest_phone|default:"—" }}
            {% endif %}
        </td>
        <td>
            {% if order.user %}
                {{ order.user.email }}
            {% else %}
                {{ order.guest_email|default:"—" }}
            {% endif %}
        </td>
        <td>{{ order.total_price }}</td>
        <td>{{ order.created_at }}</td>
    </tr>
    {% empty %}
    <tr>
        <td colspan="7">Заказов пока нет</td>
    </tr>
    {% endfor %}
</table>
<h1>Топ популярных товаров</h1>
<table border="1">
<tr>
    <th>Название товара</th>
    <th>Количество заказов</th>
</tr>
{% for item in popular %}
<tr>
    <td>{{ item.name }}</td>
    <td>{{ item.order_count }}</td>
</tr>
{% empty %}
<tr>
    <td colspan="2">Нет данных</td>
</tr>
{% endfor %}
</table>
<p><a href="{% url 'core:home' %}">Главная страница</a></p>
{% endblock %}